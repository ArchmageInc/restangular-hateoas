!function(a){"use strict";a.module("restangular-hateoas",["restangular"])}(angular),function(a,b){"use strict";a.module("restangular-hateoas").provider("hateoasConfiguration",function(){function a(a,c){b.isObject(a)?b.merge(e,a):b.isString(a)&&null!==b.get(e,a,null)&&b.set(a,c)}function c(){return e}var d={map:{restangularCollection:"$restangularCollection",restangularElement:"$restangularElement",save:"$restangularSave",service:"$restangularService",embedded:"_embedded",links:"_links",selfLink:"_links.self.href",nextLink:"_links.next.href",original:"_original",changed:"_changed",fromServer:"_fromServer",hiddenPromise:"_promise"}},e=b.clone(d,!0);this.set=a,this.$get=c})}(angular,_),function(a,b){"use strict";a.module("restangular-hateoas").factory("HateoasApi",["$http","Restangular","hateoasConfiguration","HateoasCommon","HateoasDecorator",function(a,c,d,e,f){function g(a,b){return b&&a.falseCollection&&(a=a[0]),a}function h(a,c){return c=c&&b.isArray(a),a?(c||e.convertFromHateoas(a),f.decorate(a,c)):a}function i(a,c,d,f,g,h){d=b.get(g,"config._route")||d,c="getList"===c&&!b.get(a,l.embedded)&&b.get(a,l.links)?"getListOne":c,a=a||b.get(g,"config.data",{});var i=b.clone(a,!0);switch(c){case"getListOne":b.set(i,l.original,b.clone(a,!1)),i=[i],i.falseCollection=!0;break;case"getList":b.forEach(b.get(i,l.embedded+"."+d),function(a){b.set(a,l.original,b.clone(a,!1))}),b.set(i,l.links,e.cleanTemplatedLinks(b.get(i,l.links)));break;case"post":case"patch":b.set(i,l.original,b.clone(a,!1)),b.set(i,l.selfLink,g.headers("Location")||b.get(i,l.selfLink));break;case"get":b.set(i,l.original,b.clone(a,!1));break;case"remove":case"delete":i=void 0}return b.isObject(i)&&(i.$object=h.promise.$object),i}function j(c,d,f,g,h,i,j){h=b.extend({},b.get(a,"default.headers.common"),h),f=b.get(i,"_route",f);var k;switch(delete i._route,d){case"patch":case"update":k=c.getChangedProperties();break;case"post":case"put":k=e.convertToHateoas(c)}return b.extend(j,{_hateoas:!0,_route:f,_model:c}),{headers:h,params:i,element:k,httpConfig:j}}function k(a){var d=this;b.extend(this,c.withConfig(function(b){b.setBaseUrl(a),b.setRestangularFields(l),b.configuration.getIdFromElem=e.getId,b.setOnBeforeElemRestangularized(g),b.setOnElemRestangularized(h),b.addResponseInterceptor(i),b.addFullRequestInterceptor(j)})),b.set(this,l.service,this.service),this.ModelService=function(a,c){var e=this;b.extend(this,b.get(d,l.service)(a),{_modelDefaults:c,_route:a,create:b.bind(function(a){a=b.pick(a,b.keys(e._modelDefaults));var c=d.restangularizeElement(null,b.clone(e._modelDefaults),e._route);return b.extend(c,a),c},this)}),d.addElementTransformer(a,function(a){return a._modelService=e,a})}}var l=d.map;return k}])}(angular,_),function(a,b,c){"use strict";a.module("restangular-hateoas").factory("HateoasCommon",["hateoasConfiguration",function(a){var d=a.map,e={getId:function(a){if(a){var b=c.isString(a)?a:a.getRestangularUrl(),d=b.match(/\/(?:.(?!\/))+$/);return d?d[0].substr(1):void 0}},applyHateoasChild:function(a,c){b.defineProperty(a,c,{enumerable:!1,configurable:!0,get:function(){var b=a.all(c).getList(),f=b.$object;return e.defineChildValue(a,c,f),e.defineChildValue(a.$object,c,f),b=b.then(function(b){return e.defineChildValue(a,c,b),e.defineChildValue(a.$object,c,b),b}),e.defineChildValue(f,"then",b.then),e.defineHiddenChildValue(f,d.hiddenPromise,b),f},set:function(b){return e.defineChildValue(a,c,b),b}})},cleanTemplatedLinks:function(a){var b=c.clone(a,!0);return c.isObject(a)?(c.forEach(b,function(a,c){b[c]=e.cleanTemplatedLinks(a)}),b):c.isString(b)?b.replace(/(.+)\{[\?|&].+\}/,"$1"):b},convertFromHateoas:function(a){return c.get(a,d.links)?(c.set(a,d.links,e.cleanTemplatedLinks(c.get(a,d.links))),c.forEach(c.get(a,d.links),function(b,f){"self"===f||c.get(a,f)?c.get(a,f)&&c.set(a,f+"."+d.selfLink,b):e.applyHateoasChild(a,f)}),a):a},convertToHateoas:function(a){var b=c.get(a,d.restangularCollection)?[]:{};return c.forEach(a,function(a,e){c.isObject(a)&&c.get(a,d.restangularElement)&&c.set(b,e,a.getRestangularUrl()),c.isDate(a)&&c.set(b,e,a),(c.isNull(a)||!c.isObject(a))&&c.set(b,e,a),""===a&&c.set(b,e,null)}),b},defineChildValue:function(a,c,d){return a?(b.defineProperty(a,c,{enumerable:!0,configurable:!0,writable:!0,value:d}),a):void 0},defineHiddenChildValue:function(a,c,d){return a?(b.defineProperty(a,c,{enumerable:!1,configurable:!0,writable:!0,value:d}),a):void 0}};return e}])}(angular,Object,_),function(a,b,c){"use strict";a.module("restangular-hateoas").factory("HateoasDecorator",["hateoasConfiguration","HateoasCommon","$q",function(a,b,d){function e(a){return c.get(a,n.fromServer)?a.patch(a.getChangedProperties()).then(function(){return c.merge(c.get(a,n.original),a.plain()),a}):c.get(a,n.save)().then(function(d){return c.merge(c.get(a,n.links),c.get(d,n.links)),c.set(a,n.fromServer,!0),c.merge(c.get(a,n.original),b.convertToHateoas(a)),a})}function f(a){var d=b.convertToHateoas(a),e={};return c.get(a,n.original)?(c.forEach(c.get(a,n.original),function(a,b){c.get(d,b)!==a&&c.set(e,b,c.get(d,b))}),e):a}function g(a){return c.get(a,n.original)&&c.extend(a,c.clone(c.get(a,n.original))),a}function h(a,b){if(b&&a){var d=b.split("."),e=d.shift(),f=d.join(".");return c.get(a,e+"."+n.hiddenPromise)?a[e].then(function(a){return f?k(a,[f]):a},function(){return null}):c.get(a,e)&&f?k(c.get(a,e),[f]):c.get(a,e)?c.get(a,e):void 0}}function i(a){return!!c.get(a,n.nextLink)}function j(a,b){return a.hasNext()?a.allUrl(a.route,c.get(a,n.nextLink)).getList(b).then(function(b){return c.set(a,n.nextLink,c.get(b,n.nextLink)),a.push.apply(a,b),a}):d.when(a)}function k(a,b){var e,f;if(c.isArray(a))for(e=[],f=0;f<a.length;f++)e.push(k(a[f],b));else for(e={},f=0;b>f;f++)e[b[f]]=d.when(h(a,b[f]));return d.all(e).then(function(){return a})}function l(a,c){var d=Array.prototype.slice.call(arguments,2),e=c.apply(a,d);return b.defineHiddenChildValue(e.$object,"then",e.then),e}function m(a,c){var d=Array.prototype.slice.call(arguments,2),e=c.apply(a,d);return b.defineHiddenChildValue(e.$object,"then",e.then),e}var n=a.map,o={decorateElement:function(a){return c.set(a,n.restangularCollection,!1),c.set(a,n.restangularElement,!0),c.set(a,n.changed,!1),c.extend(a,{getId:c.partial(b.getId,a),save:c.partial(e,a),revert:c.partial(g,a),getChangedProperties:c.partial(f,a),resolve:c.partial(k,a),get:c.partial(m,a,a.get),getList:c.partial(l,a,a.getList)}),a},decorateCollection:function(a){return c.set(a,n.restangularCollection,!0),c.set(a,n.restangularElement,!1),c.set(a,n.changed,!1),c.extend(a,{hasNext:c.partial(i,a),getNext:c.partial(j,a),resolve:c.partial(k,a),get:c.partial(m,a,a.get),getList:c.partial(l,a,a.getList)}),a},decorate:function(a,b){return b?o.decorateCollection(a):o.decorateElement(a)}};return o}])}(angular,Object,_);
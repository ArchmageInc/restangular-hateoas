!function(a){"use strict";a.module("restangular-hateoas",["restangular"])}(angular),function(a,b){"use strict";a.module("restangular-hateoas").provider("HateoasConfiguration",function(){function a(a,c){b.isObject(a)?b.merge(e,a):b.isString(a)&&b.set(e,a,c)}function c(){return b.clone(e,!0)}var d={map:{restangularCollection:"$restangularCollection",restangularElement:"$restangularElement",save:"$restangularSave",service:"$restangularService",embedded:"_embedded",links:"_links",selfLink:"_links.self.href",nextLink:"_links.next.href",original:"_original",changed:"_changed",fromServer:"_fromServer",hiddenPromise:"_promise"}},e=b.clone(d,!0);this.getConfiguration=c,this.setConfiguration=a,this.$get=b.constant(e)})}(angular,_),function(a,b){"use strict";a.module("restangular-hateoas").factory("HateoasApi",["$http","Restangular","HateoasConfiguration","HateoasCommon","HateoasDecorator",function(a,c,d,e,f){function g(a,b){return b&&a.falseCollection&&(a=a[0]),a}function h(a,c){return c=c&&b.isArray(a),a?(c||e.convertFromHateoas(a),f.decorate(a,c)):a}function i(a,c,d,f,g,h,i){f=b.get(h,"config._route")||f,d="getList"===d&&!b.get(c,n.embedded)&&b.get(c,n.links)?"getListOne":d,c=c||b.get(h,"config.data",{});var j=b.clone(c,!0);switch(d){case"getListOne":b.set(j,n.original,b.clone(c,!1)),j=[j],j.falseCollection=!0;break;case"getList":var k=b.get(j,n.embedded+"."+f);b.forEach(k,function(a){b.set(a,n.original,b.clone(a,!1))}),b.set(k,n.links,e.cleanTemplatedLinks(b.get(j,n.links))),j=k;break;case"post":case"patch":b.set(j,n.original,b.clone(c,!1)),b.set(j,n.selfLink,h.headers("Location")||b.get(j,n.selfLink));break;case"get":b.set(j,n.original,b.clone(c,!1));break;case"remove":case"delete":j=void 0}return b.isObject(j)&&(j.$object=i.promise.$object),j}function j(c,d,f,g,h,i,j,k){i=b.extend({},b.get(a,"default.headers.common"),i),i.Authorization=c.authorization.token,g=b.get(j,"_route",g);var l,m=k.processRaw;switch(delete j._route,f){case"patch":case"update":l=m?d:d.getChangedProperties();break;case"post":case"put":l=m?d:e.convertToHateoas(d)}return b.extend(k,{_hateoas:!0,_route:g,_model:d}),{headers:i,params:j,element:l,httpConfig:k}}function k(a,c,d){d=b.pick(d,b.keys(c._modelDefaults));var e=a.restangularizeElement(null,b.clone(c._modelDefaults),c._route);return b.extend(e,d),e}function l(a,b){return b._modelService=a,b}function m(a){var d=this;b.extend(this,c.withConfig(function(c){c.setBaseUrl(a),c.setRestangularFields(n),c.configuration.getIdFromElem=e.getId,c.setOnBeforeElemRestangularized(g),c.setOnElemRestangularized(h),c.addResponseInterceptor(b.partial(i,d)),c.addFullRequestInterceptor(b.partial(j,d))})),b.set(this,n.service,this.service),this.ModelService=function(a,c,e){var f=this;b.extend(this,d.all(a).withHttpConfig(e),{_modelDefaults:c,_route:a,create:b.bind(b.partial(k,d,f),this)}),d.addElementTransformer(a,b.partial(l,f))},this.authorization={}}var n=d.map;return m.prototype.setAuthToken=function(a){this.authorization.token=a},m}])}(angular,_),function(a,b,c){"use strict";a.module("restangular-hateoas").factory("HateoasCommon",["HateoasConfiguration",function(a){var d=a.map,e={getId:function(a){if(a){var b=c.isString(a)?a:a.getRestangularUrl(),d=b.match(/\/(?:.(?!\/))+$/);return d?d[0].substr(1):void 0}},applyHateoasChild:function(a,c){b.defineProperty(a,c,{enumerable:!1,configurable:!0,get:function(){var b=a.all(c).getList(),f=b.$object;return e.defineChildValue(a,c,f),e.defineChildValue(a.$object,c,f),b=b.then(function(b){return e.defineChildValue(a,c,b),e.defineChildValue(a.$object,c,b),b}),e.defineChildValue(f,"then",b.then),e.defineHiddenChildValue(f,d.hiddenPromise,b),f},set:function(b){return e.defineChildValue(a,c,b),b}})},cleanTemplatedLinks:function(a){if(c.isPlainObject(a)){var b={};return c.forEach(a,function(a,c){b[c]=e.cleanTemplatedLinks(a)}),b}return c.isString(a)?a.replace(/(.+)\{[\?|&].+\}/,"$1"):void 0},convertFromHateoas:function(a){return c.get(a,d.links)?(c.set(a,d.links,e.cleanTemplatedLinks(c.get(a,d.links))),c.forEach(c.get(a,d.links),function(b,f){"self"===f||c.get(a,f)?c.get(a,f)&&c.set(a,f+"."+d.selfLink.substring(0,d.selfLink.lastIndexOf(".")),b):e.applyHateoasChild(a,f)}),a):a},isRestangularProperty:function(a){return!!c.includes(c.values(d),a)},convertToHateoas:function(a){var b=c.get(a,d.restangularCollection)?[]:{};return c.forEach(a,function(a,f){c.isPlainObject(a)&&c.get(a,d.restangularElement)&&c.set(b,f,a.getRestangularUrl()),c.isDate(a)&&c.set(b,f,a),e.isRestangularProperty(f)||!c.isNull(a)&&c.isObject(a)||c.set(b,f,a),""===a&&c.set(b,f,null)}),b},defineChildValue:function(a,c,d){return a?(b.defineProperty(a,c,{enumerable:!0,configurable:!0,writable:!0,value:d}),a):void 0},defineHiddenChildValue:function(a,c,d){return a?(b.defineProperty(a,c,{enumerable:!1,configurable:!0,writable:!0,value:d}),a):void 0}};return e}])}(angular,Object,_),function(a,b){"use strict";a.module("restangular-hateoas").factory("HateoasDecorator",["HateoasConfiguration","HateoasCommon","$q",function(a,c,d){function e(a){return b.get(a,n.fromServer)?a.patch(a.getChangedProperties()).then(function(){return b.merge(b.get(a,n.original),a.plain()),a}):b.get(a,n.save)().then(function(d){return b.merge(b.get(a,n.links),b.get(d,n.links)),b.set(a,n.fromServer,!0),b.merge(b.get(a,n.original),c.convertToHateoas(a)),a})}function f(a){var d=c.convertToHateoas(a),e={};return b.get(a,n.original)?(b.forEach(b.get(a,n.original),function(a,c){b.get(d,c)!==a&&b.set(e,c,b.get(d,c))}),e):a}function g(a){return b.get(a,n.original)&&b.extend(a,b.clone(b.get(a,n.original))),a}function h(a,c){if(c&&a){var d=c.split("."),e=d.shift(),f=d.join(".");return b.get(a,e+"."+n.hiddenPromise)?a[e].then(function(a){return f?k(a,[f]):a},function(){return null}):b.get(a,e)&&f?k(b.get(a,e),[f]):b.get(a,e)?b.get(a,e):void 0}}function i(a){return!!b.get(a,n.nextLink)}function j(a,c){return a.hasNext()?a.allUrl(a.route,b.get(a,n.nextLink)).getList(c).then(function(c){return b.set(a,n.nextLink,b.get(c,n.nextLink)),a.push.apply(a,c),a}):d.when(a)}function k(a,c){var e,f;if(b.isArray(a))for(e=[],f=0;f<a.length;f++)e.push(k(a[f],c));else for(e={},f=0;c>f;f++)e[c[f]]=d.when(h(a,c[f]));return d.all(e).then(b.constant(a))}function l(a,b){var d=Array.prototype.slice.call(arguments,2),e=b.apply(a,d);return c.defineHiddenChildValue(e.$object,"then",e.then),e}function m(a,b){var d=Array.prototype.slice.call(arguments,2),e=b.apply(a,d);return c.defineHiddenChildValue(e.$object,"then",e.then),e}var n=a.map,o={decorateElement:function(a){return b.set(a,n.restangularCollection,!1),b.set(a,n.restangularElement,!0),b.set(a,n.changed,!1),b.extend(a,{getId:b.partial(c.getId,a),save:b.partial(e,a),revert:b.partial(g,a),getChangedProperties:b.partial(f,a),resolve:b.partial(k,a),get:b.partial(m,a,a.get),getList:b.partial(l,a,a.getList)}),a},decorateCollection:function(a){return b.set(a,n.restangularCollection,!0),b.set(a,n.restangularElement,!1),b.set(a,n.changed,!1),b.extend(a,{hasNext:b.partial(i,a),getNext:b.partial(j,a),resolve:b.partial(k,a),get:b.partial(m,a,a.get),getList:b.partial(l,a,a.getList)}),a},decorate:function(a,b){return b?o.decorateCollection(a):o.decorateElement(a)}};return o}])}(angular,_);
//# sourceMappingURL=restangular-hateoas.min.js.map